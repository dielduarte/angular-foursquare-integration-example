{"version":3,"sources":["app.js"],"names":["angular","module","softOptions","restrict","templateUrl","controller","directive","softOptionsController","$scope","$timeout","modalFactory","geolocationFactory","leafletFactory","_openWelcome","showWelcomeModal","then","_initialActions","_openPlacesModal","showPlacesModal","_openHeatMapModal","showHeatMapModal","_openTopFiveModal","showTopFiveModal","loadingModal","getPermission","cords","setView","latitude","longitude","openPlacesModal","openHeatMapModal","openTopFiveModal","$inject","welcomeController","$mdDialog","_close","cancel","_startest","hide","vm","this","close","startest","topFiveController","foursquareAPIFactory","$mdToast","_filter","getLocation","start","searchTrendings","distance","data","_showTopFive","response","venues","places","length","forEach","v","k","setMarkerWithPopup","location","lat","lng","name","show","simple","textContent","position","hideDelay","filter","PlacesController","searchVenues","categories","_showPlaces","getCategories","heatMapController","gmapsFactory","getAddress","city","results","geometry","_showHeatMapPlaces","generateHeatMap","_open","parent","element","document","body","clickOutsideToClose","_showPlacesModal","baseTemplateUrl","_showWelcomeModal","_loadingModal","open","_showTopFiveModal","_showHeatMapModal","factory","MAPBOX_CLIENTID","MAPBOX_ACCESTOKEN","_start","long","undefined","map","remove","L","_startImagery","_setMarker","tileLayer","attribution","maxZoom","id","accessToken","addTo","_setView","latLng","marker","icon","currentLocationIcon","bindPopup","_setMarkerWithPopup","popupText","markerIcon","_generateHeatMap","heatMapMarkers","push","heatLayer","radius","blur","iconUrl","setMarker","$http","_getAddress","address","get","$q","_getPermission","navigator","geolocation","watchPosition","_setLocation","deferred","reject","promise","coords","resolve","_getLocation","defer","FOURSQUARE_CLIENID","FOURSQUARE_CLIENSECRET","FOURSQUARE_APIVERSION","FOURSQUARE_APIURL","FOURSQUARE_VERSIONPARAMETER","$httpParamSerializerJQLike","_get","endpoint","params","defaultParams","client_id","client_secret","merge","paramsURL","base_url","_getCategories","_searchVenues","ids","selected","join","ll","categoryId","_searchTrendings","limit","constant","routes","$routeProvider","otherwise","redirectTo","when","controllerAs","config","appController"],"mappings":"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","file":"app.min.js","sourcesContent":[";(function () {\n    'use strict';\n\n    angular\n        .module('app', ['env',\n                        'ngRoute',\n                        'ngSanitize',\n                        'ngMaterial',\n                        'ngMessages',\n                        'PlacesModule',\n                        'welcomeModule',\n                        'topFiveModule',\n                        'heatMapModule']);\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .directive('softOptions', softOptions);\n\n  function softOptions() {\n    return {\n      restrict:'EA',\n      templateUrl: 'widgets/soft-options/template.html',\n      controller: 'softOptionsController'\n    };\n  }\n})();\n\n;(function() {\n  'use strict';\n\n  angular\n    .module('app')\n    .controller('softOptionsController', softOptionsController);\n\n  softOptionsController.$inject = [\n      '$scope',\n      '$timeout',\n      'modalFactory',\n      'geolocationFactory',\n      'leafletFactory'\n    ];\n\n  function softOptionsController($scope, $timeout, modalFactory, geolocationFactory, leafletFactory) {\n    $scope.openPlacesModal = _openPlacesModal;\n    $scope.openHeatMapModal = _openHeatMapModal;\n    $scope.openTopFiveModal = _openTopFiveModal;\n\n    $timeout(function(){\n      _openWelcome();\n    });\n\n    /**\n     *\n     * @private\n     */\n    function _openWelcome() {\n      modalFactory.showWelcomeModal().then(function(){\n        _initialActions();\n      });\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _openPlacesModal() {\n      modalFactory.showPlacesModal();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _openHeatMapModal() {\n      modalFactory.showHeatMapModal();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _openTopFiveModal() {\n      modalFactory.showTopFiveModal();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _initialActions() {\n      modalFactory.loadingModal(true);\n      geolocationFactory.getPermission().then(function(cords) {\n        leafletFactory.setView(cords.latitude, cords.longitude);\n        modalFactory.loadingModal(false);\n      });\n    }\n  }\n})();\n\n;(function() {\n  'use strict';\n\n  angular\n    .module('welcomeModule', []);\n})();\n\n;(function() {\n  'use strict';\n\n  angular\n    .module('welcomeModule')\n    .controller('welcomeController', welcomeController);\n\n  welcomeController.$inject = ['$mdDialog'];\n\n  function welcomeController($mdDialog){\n    /* jshint ignore:start */\n    var vm = this;\n    /* jshint ignore:end */\n\n    vm.close = _close;\n    vm.startest = _startest;\n\n    /////////////////\n\n    /**\n     *\n     * @private\n     */\n    function _close() {\n      $mdDialog.cancel();\n    }\n\n    function _startest() {\n      $mdDialog.hide();\n    }\n\n  }\n})();\n\n;(function(){\n    'use strict';\n\n    angular\n        .module('topFiveModule', []);\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('topFiveModule')\n    .controller('topFiveController', topFiveController);\n\n\n  topFiveController.$inject = [\n    '$mdDialog',\n    '$scope',\n    'foursquareAPIFactory',\n    'modalFactory',\n    'geolocationFactory',\n    'leafletFactory',\n    '$mdToast'\n  ];\n\n  function topFiveController($mdDialog, $scope, foursquareAPIFactory, modalFactory, geolocationFactory, leafletFactory, $mdToast){\n    /* jshint ignore:start */\n    var vm = this;\n    /* jshint ignore:end */\n\n    vm.close = _close;\n    vm.filter = _filter;\n\n\n    /**\n     *\n     * @private\n     */\n    function _close() {\n      $mdDialog.cancel();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _filter() {\n      var cords = geolocationFactory.getLocation();\n\n      leafletFactory.start(cords.latitude, cords.longitude);\n\n      foursquareAPIFactory.searchTrendings(cords, vm.distance, 5).then(function(data){\n        _showTopFive(data.data.response.venues);\n      });\n    }\n\n    /**\n     *\n     * @param places\n     * @private\n     */\n    function _showTopFive(places) {\n      if(places.length > 0) {\n        _close();\n\n        angular.forEach(places, function(v, k){\n          leafletFactory.setMarkerWithPopup(places[k].location.lat, places[k].location.lng, places[k].name);\n        });\n      } else {\n        $mdToast.show(\n          $mdToast.simple()\n            .textContent('For you current position foursquare did not find any top five place :/!')\n            .position('top right')\n            .hideDelay(5000)\n        );\n      }\n    }\n  }\n})();\n\n;(function(){\n    'use strict';\n\n    angular\n        .module('PlacesModule', []);\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('PlacesModule')\n    .controller('PlacesController', PlacesController);\n\n\n  PlacesController.$inject = [\n    '$mdDialog',\n    '$scope',\n    'foursquareAPIFactory',\n    'geolocationFactory',\n    'leafletFactory'\n  ];\n\n  function PlacesController($mdDialog, $scope, foursquareAPIFactory, geolocationFactory, leafletFactory){\n    /* jshint ignore:start */\n    var vm = this;\n    /* jshint ignore:end */\n\n    vm.close = _close;\n    vm.filter = _filter;\n\n    foursquareAPIFactory.getCategories().then(function(data){\n      $scope.categories = data.data.response.categories;\n    });\n\n    /**\n     *\n     * @private\n     */\n    function _close() {\n      $mdDialog.cancel();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _filter() {\n      var cords = geolocationFactory.getLocation();\n      leafletFactory.start(cords.latitude, cords.longitude);\n      foursquareAPIFactory.searchVenues(cords, vm.distance, $scope.categories).then(function(data){\n        _showPlaces(data.data.response.venues);\n      });\n    }\n\n    /**\n     *\n     * @param places\n     * @private\n     */\n    function _showPlaces(places) {\n      _close();\n\n      angular.forEach(places, function(v, k){\n        leafletFactory.setMarkerWithPopup(places[k].location.lat, places[k].location.lng, places[k].name);\n      });\n\n    }\n  }\n})();\n\n;(function(){\n    'use strict';\n\n    angular\n        .module('heatMapModule', []);\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('heatMapModule')\n    .controller('heatMapController', heatMapController);\n\n\n  heatMapController.$inject = [\n    '$mdDialog',\n    '$scope',\n    'foursquareAPIFactory',\n    'modalFactory',\n    'geolocationFactory',\n    'leafletFactory',\n    'gmapsFactory'\n  ];\n\n  function heatMapController($mdDialog, $scope, foursquareAPIFactory, modalFactory, geolocationFactory, leafletFactory, gmapsFactory){\n    /* jshint ignore:start */\n    var vm = this;\n    /* jshint ignore:end */\n\n    vm.close = _close;\n    vm.filter = _filter;\n\n\n    /**\n     *\n     * @private\n     */\n    function _close() {\n      $mdDialog.cancel();\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _filter() {\n\n      var cords = {};\n\n      gmapsFactory.getAddress(vm.city).then(function(data){\n\n        cords = {\n          latitude: data.data.results[0].geometry.location.lat,\n          longitude: data.data.results[0].geometry.location.lng\n        };\n\n        leafletFactory.start(cords.latitude, cords.longitude);\n\n        foursquareAPIFactory.searchVenues(cords, 1000000, '').then(function(data){\n          _showHeatMapPlaces(data, cords);\n        });\n      });\n    }\n\n    /**\n     *\n     * @param places\n     * @param cords\n     * @private\n     */\n    function _showHeatMapPlaces(places, cords) {\n      _close();\n      leafletFactory.generateHeatMap(places.data.response.venues, cords);\n    }\n\n  }\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('modalFactory', modalFactory);\n\n  modalFactory.$inject = ['$mdDialog'];\n\n  function modalFactory($mdDialog) {\n    var baseTemplateUrl = 'modules/';\n    var templateUrl, controller;\n\n    return {\n      showPlacesModal: _showPlacesModal,\n      showWelcomeModal: _showWelcomeModal,\n      loadingModal: _loadingModal,\n      showTopFiveModal: _showTopFiveModal,\n      showHeatMapModal: _showHeatMapModal\n    };\n\n    /////////////////\n\n    /**\n     *\n     * @param ev\n     * @param templateUrl\n     * @param controller\n     * @returns {*}\n       * @private\n       */\n    function _open(templateUrl, controller) {\n      return $mdDialog.show({\n        controller: controller,\n        templateUrl: templateUrl,\n        parent: angular.element(document.body),\n        clickOutsideToClose:true\n      });\n    }\n\n\n      /**\n       *\n       * @param ev\n       * @returns {*}\n       */\n    function _showPlacesModal() {\n      templateUrl = baseTemplateUrl + 'places/places.template.html';\n      controller = 'PlacesController as vm';\n      return  _open(templateUrl, controller );\n    }\n\n    /**\n     *\n     * @param ev\n     * @returns {*}\n     */\n    function _showWelcomeModal() {\n      templateUrl = baseTemplateUrl + 'welcome/welcome.template.html';\n      controller = 'welcomeController as vm';\n      return  _open(templateUrl, controller );\n    }\n\n    /**\n     *\n     * @param ev\n     * @param open\n     * @returns {*}\n     * @private\n     */\n    function _loadingModal(open) {\n      templateUrl = 'common/layout/modals/loading.template.html';\n\n      if(open)\n        return  _open(templateUrl, '');\n      else\n        $mdDialog.cancel();\n    }\n\n    /**\n     *\n     * @returns {*}\n     * @private\n     */\n    function _showTopFiveModal() {\n      templateUrl = baseTemplateUrl + 'topFive/topFive.template.html';\n      controller = 'topFiveController as vm';\n      return  _open(templateUrl, controller );\n    }\n\n    /**\n     *\n     * @returns {*}\n     * @private\n     */\n    function _showHeatMapModal() {\n      templateUrl = baseTemplateUrl + 'heatMap/heatMap.template.html';\n      controller = 'heatMapController as vm';\n      return  _open(templateUrl, controller );\n    }\n\n  }\n\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('leafletFactory', leafletFactory);\n\n  leafletFactory.$inject = [\n    'MAPBOX_CLIENTID',\n    'MAPBOX_ACCESTOKEN',\n    'geolocationFactory'\n  ];\n\n  function leafletFactory(MAPBOX_CLIENTID, MAPBOX_ACCESTOKEN, geolocationFactory){\n    var map;\n\n\n    var markerIcon = L.icon({\n      iconUrl: 'assets/img/marker.svg'\n    });\n\n    var currentLocationIcon = L.icon({\n      iconUrl: 'assets/img/userMarker.svg'\n    });\n\n    return {\n      start: _start,\n      setView: _setView,\n      setMarker: _setMarker,\n      setMarkerWithPopup: _setMarkerWithPopup,\n      generateHeatMap: _generateHeatMap\n    };\n\n    /////////////////\n\n    /**\n     *\n     * @param lat\n     * @param long\n     * @private\n     */\n    function _start(lat, long){\n      if(map !== undefined)\n        map.remove();\n\n      map = L.map('map').setView([lat, long], 13);\n      _startImagery();\n      _setMarker(lat, long);\n    }\n\n    /**\n     *\n     * @private\n     */\n    function _startImagery(){\n      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + MAPBOX_ACCESTOKEN, {\n        attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n        maxZoom: 18,\n        id: MAPBOX_CLIENTID,\n        accessToken: MAPBOX_ACCESTOKEN\n      }).addTo(map);\n    }\n\n      /**\n       *\n       * @param lat\n       * @param long\n       * @private\n       */\n    function _setView(lat, long) {\n      map.setView(L.latLng(lat, long), 16);\n      _setMarker(lat, long);\n    }\n\n    /**\n     *\n     * @param lat\n     * @param long\n     */\n    function _setMarker(lat, long) {\n      L.marker(L.latLng(lat, long), {icon: currentLocationIcon})\n        .bindPopup('Current location! =)')\n        .addTo(map);\n    }\n\n    /**\n     *\n     * @param lat\n     * @param long\n     * @param popupText\n     * @private\n     */\n\n    function _setMarkerWithPopup(lat, long, popupText) {\n      L.marker(L.latLng(lat, long), {icon: markerIcon})\n        .bindPopup(popupText)\n        .addTo(map);\n    }\n\n    /**\n     *\n     * @param places\n     * @param cords\n     * @private\n     */\n    function _generateHeatMap(places, cords){\n\n      var heatMapMarkers = [];\n\n      angular.forEach(places, function(v, k) {\n        heatMapMarkers.push([\n          places[k].location.lat,\n          places[k].location.lng\n        ]);\n      });\n\n      var heat = L.heatLayer(heatMapMarkers,{\n        radius: 20,\n        blur: 15,\n        maxZoom: 17,\n      }).addTo(map);\n\n      _setView(cords.latitude, cords.longitude);\n    }\n\n  }\n\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('gmapsFactory', gmapsFactory);\n\n  gmapsFactory.$inject = [\n    '$http'\n  ];\n\n  function gmapsFactory($http){\n\n\n    return {\n      getAddress: _getAddress\n    };\n\n    /////////////////\n\n\n    function _getAddress(address){\n      return $http.get('http://maps.googleapis.com/maps/api/geocode/json?address='+ address +'&sensor=false');\n    }\n\n  }\n\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('geolocationFactory', geolocationFactory);\n\n  geolocationFactory.$inject = [\n    '$q',\n    '$mdDialog'\n  ];\n\n  function geolocationFactory($q, $mdDialog) {\n    var cords = {};\n    var deferred = $q.defer();\n\n    return {\n      getPermission: _getPermission,\n      getLocation: _getLocation\n    };\n\n    ///////////////\n\n    /**\n     *\n     * @private\n     */\n    function _getPermission() {\n\n      if (navigator.geolocation) {\n        navigator.geolocation.watchPosition(_setLocation);\n      }\n      else {\n        deferred.reject(\"Geolocation is not supported by this browser.\");\n      }\n\n      return deferred.promise;\n    }\n\n\n    /**\n     *\n     * @param data\n     * @private\n     */\n    function _setLocation(data) {\n      cords = {\n        latitude: data.coords.latitude,\n        longitude: data.coords.longitude\n      };\n\n      deferred.resolve(cords);\n    }\n\n    /**\n     *\n     * @returns {{}}\n     * @private\n     */\n    function _getLocation() {\n      return cords;\n    }\n\n  }\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .factory('foursquareAPIFactory', foursquareAPIFactory);\n\n  foursquareAPIFactory.$inject  = [\n    'FOURSQUARE_CLIENID',\n    'FOURSQUARE_CLIENSECRET',\n    'FOURSQUARE_APIVERSION',\n    'FOURSQUARE_APIURL',\n    'FOURSQUARE_VERSIONPARAMETER',\n    '$http',\n    '$httpParamSerializerJQLike'\n  ];\n\n  function foursquareAPIFactory(FOURSQUARE_CLIENID, FOURSQUARE_CLIENSECRET, FOURSQUARE_APIVERSION, FOURSQUARE_APIURL, FOURSQUARE_VERSIONPARAMETER, $http, $httpParamSerializerJQLike) {\n    var base_url = FOURSQUARE_APIURL + FOURSQUARE_APIVERSION;\n\n    return {\n      getCategories: _getCategories,\n      searchVenues: _searchVenues,\n      searchTrendings: _searchTrendings\n    };\n\n    ///////////////\n\n    /**\n     *\n     * @param endpoint\n     * @param params\n     * @returns {*}\n     * @private\n     */\n    function _get(endpoint, params) {\n      var defaultParams = {\n        client_id: FOURSQUARE_CLIENID,\n        client_secret: FOURSQUARE_CLIENSECRET,\n        v: FOURSQUARE_VERSIONPARAMETER\n      };\n\n      if(params !== null) {\n        defaultParams = angular.merge(defaultParams, params);\n      }\n\n      var paramsURL = $httpParamSerializerJQLike(defaultParams);\n\n      return $http.get(base_url + endpoint + paramsURL);\n    }\n    /**\n     *\n     * @returns {*}\n     * @private\n     */\n    function _getCategories() {\n      var endpoint = 'venues/categories?';\n\n      return _get(endpoint, null);\n    }\n\n    /**\n     *\n     * @param cords\n     * @param radius\n     * @param categories\n     * @returns {*}\n     * @private\n     */\n    function _searchVenues(cords, radius, categories) {\n      var endpoint = 'venues/search?';\n      var ids = [];\n\n      angular.forEach(categories, function(v, k) {\n        if(categories[k].selected)\n          ids.push(categories[k].id);\n      });\n\n      if(ids.length > 1)\n        ids.join(',');\n      else\n        ids = ids[0];\n\n      var params = {\n        ll: cords.latitude + ',' + cords.longitude,\n        radius: radius,\n        categoryId: ids\n      };\n\n      return _get(endpoint, params);\n    }\n\n    /**\n     *\n     * @param cords\n     * @param radus\n     * @param limit\n     * @returns {*}\n     * @private\n     */\n    function _searchTrendings(cords, radius, limit) {\n      var endpoint = 'venues/trending?';\n\n      var params = {\n        ll: cords.latitude + ',' + cords.longitude,\n        radius: radius,\n        limit: limit\n      };\n\n      return _get(endpoint, params);\n    }\n\n  }\n})();\n\nangular.module('env', [])\n.constant('APIURL', \"http://production.api.com\")\n.constant('MAPBOX_ACCESTOKEN', \"pk.eyJ1IjoiZGllbGR1YXJ0ZSIsImEiOiJjaWw4cGFsbm4wZTcwdWttMHY4bWdrN3R6In0.M36YS9sB4YQGmsyliwb-qg\")\n.constant('MAPBOX_CLIENTID', \"dielduarte.p9ledl7a\")\n.constant('FOURSQUARE_CLIENID', \"BFE42FYE1VA5LCDOPDDBXFNPE4GHJSIMKDOVXKK3KVBZSWDE\")\n.constant('FOURSQUARE_CLIENSECRET', \"ZBBNI3JIJXGBBR0SZ1VS0CWVOEBZPOTW5G1ZXJCUU3JREZBG\")\n.constant('FOURSQUARE_APIVERSION', \"v2/\")\n.constant('FOURSQUARE_APIURL', \"https://api.foursquare.com/\")\n.constant('FOURSQUARE_VERSIONPARAMETER', 20130815);\n\n;(function () {\n  'use strict';\n\n  angular\n    .module('app')\n    .config(routes);\n\n    routes.$inject = ['$routeProvider'];\n\n    function routes($routeProvider) {\n\n      $routeProvider.otherwise({redirectTo: '/'});\n\n      $routeProvider\n        .when('/', {\n          templateUrl: 'common/layout/index.html',\n          controller: 'appController',\n          controllerAs: 'vm'\n        });\n    }\n})();\n\n;(function(){\n  'use strict';\n\n  angular\n    .module('app')\n    .controller('appController', appController);\n\n  appController.$inject = ['leafletFactory'];\n\n  function appController(leafletFactory){\n    /* jshint ignore:start */\n    var vm = this;\n    /* jshint ignore:end */\n\n\n    leafletFactory.start(51.505, -0.09);\n  }\n})();\n"],"sourceRoot":"/source/"}